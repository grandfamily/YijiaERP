# ç¬¬äº”æ‰¹-åº“å­˜ç®¡ç†ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£

## ğŸ“¦ 2. åº“å­˜ç®¡ç†ç³»ç»Ÿ (`inventory/`)

### 2.1 æ¨¡å—æ¦‚è¿°
åº“å­˜ç®¡ç†ç³»ç»Ÿè´Ÿè´£è·Ÿè¸ªåº“å­˜æ°´å¹³ã€åº“ä½ç®¡ç†ã€åº“å­˜è°ƒæ•´å’Œé¢„è­¦æœºåˆ¶ã€‚

### 2.2 TypeScript ç±»å‹å®šä¹‰

```typescript
// src/types/inventory.ts
export interface InventoryOverview {
  totalItems: number;
  totalValue: number;
  lowStockItems: number;
  outOfStockItems: number;
  warehouseUtilization: WarehouseUtilization[];
  topMovingItems: ItemMovement[];
  stockAlerts: StockAlert[];
}

export interface WarehouseUtilization {
  warehouseId: string;
  warehouseName: string;
  totalCapacity: number;
  usedCapacity: number;
  availableCapacity: number;
  utilizationPercentage: number;
}

export interface ItemMovement {
  skuId: string;
  sku: SKU;
  totalMovement: number;
  inbound: number;
  outbound: number;
  currentStock: number;
}

export interface StockAlert {
  id: string;
  type: AlertType;
  skuId: string;
  sku: SKU;
  currentStock: number;
  minStock: number;
  maxStock: number;
  severity: AlertSeverity;
  message: string;
  createdAt: Date;
}

export type AlertType = 'low_stock' | 'out_of_stock' | 'overstock' | 'expired';
export type AlertSeverity = 'low' | 'medium' | 'high' | 'critical';

export interface InventoryItem {
  id: string;
  skuId: string;
  sku: SKU;
  warehouseId: string;
  warehouse: Warehouse;
  location: string;
  currentStock: number;
  minStockLevel: number;
  maxStockLevel: number;
  reorderPoint: number;
  unitCost: number;
  totalValue: number;
  lastMovementDate: Date;
  status: InventoryStatus;
  createdAt: Date;
  updatedAt: Date;
}

export type InventoryStatus = 'active' | 'inactive' | 'discontinued';

export interface InventoryMovement {
  id: string;
  skuId: string;
  sku: SKU;
  type: MovementType;
  quantity: number;
  reference: string;
  reason: string;
  operatorId: string;
  operator: User;
  warehouseId: string;
  warehouse: Warehouse;
  location: string;
  unitCost: number;
  totalCost: number;
  createdAt: Date;
}

export type MovementType = 
  | 'inbound' 
  | 'outbound' 
  | 'adjustment_in' 
  | 'adjustment_out' 
  | 'transfer_in' 
  | 'transfer_out';

export interface StockAdjustmentData {
  inventoryItemId: string;
  quantityChange: number;
  reason: string;
  reference?: string;
}

export interface BulkInventoryUpdate {
  itemId: string;
  minStock?: number;
  maxStock?: number;
  reorderPoint?: number;
}

export interface InventoryFilters {
  warehouse: string;
  category: string;
  status: InventoryStatus[];
  alertLevel: AlertSeverity[];
  searchTerm: string;
}
```

### 2.3 Inventory ä¸»ç»„ä»¶

```typescript
// src/components/inventory/Inventory.tsx
import React, { useState, useEffect } from 'react';
import { toast } from 'react-hot-toast';
import {
  ChartPieIcon,
  PackageIcon,
  LocationMarkerIcon,
  SwitchHorizontalIcon,
  ExclamationTriangleIcon,
  DownloadIcon,
  UploadIcon
} from '@heroicons/react/24/outline';

import { useInventory } from '../../hooks/useInventory';
import { useInboundRegisters } from '../../hooks/useInboundRegister';
import { useGlobalStore } from '../../store/globalStore';
import { generateId, getCurrentUser } from '../../utils/helpers';
import {
  InventoryOverviewPanel,
  InventoryItemsList,
  LocationManagement,
  InventoryMovements,
  StockAlerts,
  InventorySummaryCard
} from './components';

interface InventoryProps {
  activeView?: InventoryView;
}

type InventoryView = 'overview' | 'items' | 'locations' | 'movements' | 'alerts';

const Inventory: React.FC<InventoryProps> = ({ activeView = 'overview' }) => {
  const [currentView, setCurrentView] = useState<InventoryView>(activeView);
  const [inventoryData, setInventoryData] = useState<InventoryOverview | null>(null);
  const [inventoryItems, setInventoryItems] = useState<InventoryItem[]>([]);
  const [movements, setMovements] = useState<InventoryMovement[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  // å…¨å±€çŠ¶æ€
  const globalInventory = useInventory();
  const inboundRegisters = useInboundRegisters();
  const { updateInventoryItem, addInventoryItem } = useGlobalStore();

  useEffect(() => {
    loadInventoryData();
  }, [globalInventory, inboundRegisters]);

  const loadInventoryData = async () => {
    setIsLoading(true);
    try {
      // è®¡ç®—åº“å­˜æ¦‚è§ˆ
      const overview = calculateInventoryOverview();
      setInventoryData(overview);

      // åŠ è½½åº“å­˜é¡¹ç›®
      setInventoryItems(globalInventory);

      // ç”Ÿæˆåº“å­˜å˜åŠ¨è®°å½•
      const movementRecords = generateMovementRecords();
      setMovements(movementRecords);

    } catch (error) {
      console.error('Failed to load inventory data:', error);
      toast.error('åŠ è½½åº“å­˜æ•°æ®å¤±è´¥');
    } finally {
      setIsLoading(false);
    }
  };

  const calculateInventoryOverview = (): InventoryOverview => {
    const totalItems = globalInventory.length;
    const totalValue = globalInventory.reduce((sum, item) => 
      sum + (item.currentStock * item.unitCost), 0
    );

    // ä½åº“å­˜å’Œç¼ºè´§ç»Ÿè®¡
    const lowStockItems = globalInventory.filter(item => 
      item.currentStock <= item.minStockLevel && item.currentStock > 0
    ).length;
    
    const outOfStockItems = globalInventory.filter(item => 
      item.currentStock === 0
    ).length;

    // ä»“åº“åˆ©ç”¨ç‡ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
    const warehouseUtilization: WarehouseUtilization[] = [
      {
        warehouseId: 'wh-001',
        warehouseName: 'ä¸»ä»“åº“',
        totalCapacity: 10000,
        usedCapacity: 7500,
        availableCapacity: 2500,
        utilizationPercentage: 75
      },
      {
        warehouseId: 'wh-002',
        warehouseName: 'æ¬¡ä»“åº“',
        totalCapacity: 5000,
        usedCapacity: 3200,
        availableCapacity: 1800,
        utilizationPercentage: 64
      }
    ];

    // çƒ­é—¨å•†å“ç§»åŠ¨
    const topMovingItems: ItemMovement[] = globalInventory
      .slice(0, 10)
      .map(item => ({
        skuId: item.skuId,
        sku: item.sku,
        totalMovement: Math.floor(Math.random() * 1000),
        inbound: Math.floor(Math.random() * 600),
        outbound: Math.floor(Math.random() * 400),
        currentStock: item.currentStock
      }));

    // åº“å­˜é¢„è­¦
    const stockAlerts: StockAlert[] = globalInventory
      .filter(item => 
        item.currentStock <= item.minStockLevel || 
        item.currentStock >= item.maxStockLevel
      )
      .map(item => ({
        id: `alert-${item.id}`,
        type: item.currentStock === 0 ? 'out_of_stock' : 
              item.currentStock <= item.minStockLevel ? 'low_stock' : 'overstock',
        skuId: item.skuId,
        sku: item.sku,
        currentStock: item.currentStock,
        minStock: item.minStockLevel,
        maxStock: item.maxStockLevel,
        severity: item.currentStock === 0 ? 'critical' : 
                 item.currentStock <= item.minStockLevel * 0.5 ? 'high' : 'medium',
        message: item.currentStock === 0 ? 'å•†å“ç¼ºè´§' :
                item.currentStock <= item.minStockLevel ? 'åº“å­˜ä¸è¶³' : 'åº“å­˜è¿‡é‡',
        createdAt: new Date()
      }));

    return {
      totalItems,
      totalValue,
      lowStockItems,
      outOfStockItems,
      warehouseUtilization,
      topMovingItems,
      stockAlerts
    };
  };

  const generateMovementRecords = (): InventoryMovement[] => {
    // åŸºäºå…¥åº“ç™»è®°ç”Ÿæˆåº“å­˜å˜åŠ¨è®°å½•
    return inboundRegisters.map(register => ({
      id: `movement-${register.id}`,
      skuId: register.skuId,
      sku: register.sku,
      type: 'inbound',
      quantity: register.actualQuantity,
      reference: register.purchaseRequestNumber,
      reason: 'é‡‡è´­å…¥åº“',
      operatorId: register.receiverId,
      operator: register.receiver,
      warehouseId: register.warehouseId,
      warehouse: register.warehouse,
      location: register.storageLocation,
      unitCost: register.unitPrice,
      totalCost: register.totalValue,
      createdAt: register.createdAt
    }));
  };

  // åº“å­˜è°ƒæ•´
  const handleStockAdjustment = async (adjustmentData: StockAdjustmentData) => {
    try {
      const item = inventoryItems.find(item => item.id === adjustmentData.inventoryItemId);
      if (!item) {
        throw new Error('åº“å­˜é¡¹ç›®ä¸å­˜åœ¨');
      }

      // æ›´æ–°åº“å­˜æ•°é‡
      const newStock = item.currentStock + adjustmentData.quantityChange;
      
      updateInventoryItem(item.id, {
        currentStock: Math.max(0, newStock),
        lastMovementDate: new Date(),
        updatedAt: new Date()
      });

      // è®°å½•åº“å­˜å˜åŠ¨
      const movement: InventoryMovement = {
        id: generateId(),
        skuId: item.skuId,
        sku: item.sku,
        type: adjustmentData.quantityChange > 0 ? 'adjustment_in' : 'adjustment_out',
        quantity: Math.abs(adjustmentData.quantityChange),
        reference: adjustmentData.reference || 'MANUAL_ADJ',
        reason: adjustmentData.reason,
        operatorId: getCurrentUser().id,
        operator: getCurrentUser(),
        warehouseId: item.warehouseId,
        warehouse: item.warehouse,
        location: item.location,
        unitCost: item.unitCost,
        totalCost: Math.abs(adjustmentData.quantityChange) * item.unitCost,
        createdAt: new Date()
      };

      setMovements(prev => [movement, ...prev]);
      
      toast.success('åº“å­˜è°ƒæ•´å®Œæˆ');
    } catch (error) {
      console.error('Failed to adjust stock:', error);
      toast.error('åº“å­˜è°ƒæ•´å¤±è´¥');
    }
  };

  // åº“ä½å˜æ›´
  const handleLocationChange = async (itemId: string, newLocation: string) => {
    try {
      updateInventoryItem(itemId, {
        location: newLocation,
        updatedAt: new Date()
      });

      toast.success('åº“ä½å˜æ›´æˆåŠŸ');
    } catch (error) {
      console.error('Failed to change location:', error);
      toast.error('åº“ä½å˜æ›´å¤±è´¥');
    }
  };

  // æ‰¹é‡æ›´æ–°åº“å­˜
  const handleBulkUpdate = async (updates: BulkInventoryUpdate[]) => {
    try {
      for (const update of updates) {
        await updateInventoryItem(update.itemId, {
          minStockLevel: update.minStock,
          maxStockLevel: update.maxStock,
          reorderPoint: update.reorderPoint,
          updatedAt: new Date()
        });
      }

      toast.success(`æ‰¹é‡æ›´æ–° ${updates.length} ä¸ªåº“å­˜é¡¹ç›®`);
    } catch (error) {
      console.error('Failed to bulk update inventory:', error);
      toast.error('æ‰¹é‡æ›´æ–°å¤±è´¥');
    }
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* é¡µé¢æ ‡é¢˜ */}
      <div className="bg-white shadow">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="py-6">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-3xl font-bold text-gray-900">åº“å­˜ç®¡ç†</h1>
                <p className="mt-1 text-sm text-gray-500">
                  è·Ÿè¸ªåº“å­˜æ°´å¹³ã€ç®¡ç†åº“ä½å’Œç›‘æ§åº“å­˜å˜åŠ¨
                </p>
              </div>
              
              <div className="flex items-center space-x-4">
                <InventorySummaryCard data={inventoryData} />
                
                <button
                  onClick={() => {/* å¯¼å‡ºåº“å­˜æŠ¥è¡¨ */}}
                  className="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                >
                  <DownloadIcon className="h-4 w-4 mr-2" />
                  å¯¼å‡ºæŠ¥è¡¨
                </button>
                
                <button
                  onClick={() => {/* æ‰¹é‡å¯¼å…¥ */}}
                  className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                >
                  <UploadIcon className="h-4 w-4 mr-2" />
                  æ‰¹é‡å¯¼å…¥
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* æ ‡ç­¾é¡µå¯¼èˆª */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="border-b border-gray-200">
          <nav className="-mb-px flex space-x-8" aria-label="Tabs">
            {[
              { key: 'overview', label: 'åº“å­˜æ¦‚è§ˆ', icon: ChartPieIcon },
              { key: 'items', label: 'åº“å­˜é¡¹ç›®', icon: PackageIcon },
              { key: 'locations', label: 'åº“ä½ç®¡ç†', icon: LocationMarkerIcon },
              { key: 'movements', label: 'åº“å­˜å˜åŠ¨', icon: SwitchHorizontalIcon },
              { key: 'alerts', label: 'åº“å­˜é¢„è­¦', icon: ExclamationTriangleIcon }
            ].map((tab) => {
              const Icon = tab.icon;
              return (
                <button
                  key={tab.key}
                  onClick={() => setCurrentView(tab.key as InventoryView)}
                  className={`
                    group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm
                    ${currentView === tab.key
                      ? 'border-blue-500 text-blue-600'
                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                    }
                  `}
                >
                  <Icon className={`
                    -ml-0.5 mr-2 h-5 w-5
                    ${currentView === tab.key ? 'text-blue-500' : 'text-gray-400 group-hover:text-gray-500'}
                  `} />
                  {tab.label}
                  {tab.key === 'alerts' && inventoryData?.stockAlerts.length && (
                    <span className="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                      {inventoryData.stockAlerts.length}
                    </span>
                  )}
                </button>
              );
            })}
          </nav>
        </div>
      </div>

      {/* å†…å®¹åŒºåŸŸ */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {currentView === 'overview' && (
          <InventoryOverviewPanel 
            data={inventoryData}
            onRefresh={loadInventoryData}
          />
        )}
        
        {currentView === 'items' && (
          <InventoryItemsList 
            items={inventoryItems}
            onStockAdjustment={handleStockAdjustment}
            onLocationChange={handleLocationChange}
            onBulkUpdate={handleBulkUpdate}
          />
        )}
        
        {currentView === 'locations' && (
          <LocationManagement 
            items={inventoryItems}
            warehouses={inventoryData?.warehouseUtilization}
            onLocationChange={handleLocationChange}
          />
        )}
        
        {currentView === 'movements' && (
          <InventoryMovements 
            movements={movements}
            onRefresh={loadInventoryData}
          />
        )}
        
        {currentView === 'alerts' && (
          <StockAlerts 
            alerts={inventoryData?.stockAlerts || []}
            onResolve={(alertId) => {
              // å¤„ç†é¢„è­¦è§£å†³é€»è¾‘
            }}
            onRefresh={loadInventoryData}
          />
        )}
      </div>
    </div>
  );
};

export default Inventory;
```

### 2.4 InventoryOverviewPanel åº“å­˜æ¦‚è§ˆç»„ä»¶

```typescript
// src/components/inventory/InventoryOverviewPanel.tsx
import React from 'react';
import {
  PackageIcon,
  CurrencyDollarIcon,
  ExclamationTriangleIcon,
  XCircleIcon,
  RefreshIcon
} from '@heroicons/react/24/outline';

import { MetricCard, WarehouseUtilizationChart, TopMovingItemsList } from '../ui';
import { formatCurrency, formatNumber } from '../../utils/format';

interface InventoryOverviewPanelProps {
  data: InventoryOverview | null;
  onRefresh: () => void;
}

const InventoryOverviewPanel: React.FC<InventoryOverviewPanelProps> = ({ 
  data, 
  onRefresh 
}) => {
  if (!data) {
    return (
      <div className="animate-pulse space-y-6">
        <div className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
          {[...Array(4)].map((_, i) => (
            <div key={i} className="bg-white overflow-hidden shadow rounded-lg">
              <div className="p-5">
                <div className="h-4 bg-gray-300 rounded w-3/4"></div>
                <div className="mt-4 h-8 bg-gray-300 rounded w-1/2"></div>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* å…³é”®æŒ‡æ ‡å¡ç‰‡ */}
      <div className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
        <MetricCard
          title="åº“å­˜æ€»é‡"
          value={formatNumber(data.totalItems)}
          subtitle="ä¸ªSKU"
          icon={<PackageIcon className="h-6 w-6" />}
          color="blue"
        />
        
        <MetricCard
          title="åº“å­˜æ€»ä»·å€¼"
          value={formatCurrency(data.totalValue)}
          subtitle="å½“å‰ä¼°å€¼"
          icon={<CurrencyDollarIcon className="h-6 w-6" />}
          color="green"
        />
        
        <MetricCard
          title="ä½åº“å­˜å•†å“"
          value={data.lowStockItems}
          subtitle="éœ€è¦è¡¥è´§"
          icon={<ExclamationTriangleIcon className="h-6 w-6" />}
          color="yellow"
        />
        
        <MetricCard
          title="ç¼ºè´§å•†å“"
          value={data.outOfStockItems}
          subtitle="ç´§æ€¥å¤„ç†"
          icon={<XCircleIcon className="h-6 w-6" />}
          color="red"
        />
      </div>

      {/* ä»“åº“åˆ©ç”¨ç‡å’Œçƒ­é—¨å•†å“ */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* ä»“åº“åˆ©ç”¨ç‡ */}
        <div className="bg-white overflow-hidden shadow rounded-lg">
          <div className="px-4 py-5 sm:p-6">
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-lg leading-6 font-medium text-gray-900">
                ä»“åº“åˆ©ç”¨ç‡
              </h3>
              <button
                onClick={onRefresh}
                className="inline-flex items-center px-2 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50"
              >
                <RefreshIcon className="h-3 w-3 mr-1" />
                åˆ·æ–°
              </button>
            </div>
            <WarehouseUtilizationChart data={data.warehouseUtilization} />
          </div>
        </div>

        {/* çƒ­é—¨å•†å“ç§»åŠ¨ */}
        <div className="bg-white overflow-hidden shadow rounded-lg">
          <div className="px-4 py-5 sm:p-6">
            <h3 className="text-lg leading-6 font-medium text-gray-900 mb-4">
              çƒ­é—¨å•†å“ç§»åŠ¨
            </h3>
            <TopMovingItemsList items={data.topMovingItems} />
          </div>
        </div>
      </div>

      {/* åº“å­˜é¢„è­¦æ±‡æ€» */}
      <div className="bg-white shadow overflow-hidden sm:rounded-md">
        <div className="px-4 py-5 sm:px-6 border-b border-gray-200">
          <h3 className="text-lg leading-6 font-medium text-gray-900">
            åº“å­˜é¢„è­¦æ±‡æ€»
          </h3>
        </div>
        <ul className="divide-y divide-gray-200">
          {data.stockAlerts.slice(0, 5).map((alert) => (
            <li key={alert.id} className="px-4 py-4 sm:px-6">
              <div className="flex items-center justify-between">
                <div className="flex-1 min-w-0">
                  <div className="flex items-center">
                    <div className="flex-shrink-0">
                      {alert.type === 'out_of_stock' ? (
                        <XCircleIcon className="h-5 w-5 text-red-500" />
                      ) : alert.type === 'low_stock' ? (
                        <ExclamationTriangleIcon className="h-5 w-5 text-yellow-500" />
                      ) : (
                        <PackageIcon className="h-5 w-5 text-blue-500" />
                      )}
                    </div>
                    <div className="ml-4 min-w-0 flex-1">
                      <p className="text-sm font-medium text-gray-900 truncate">
                        {alert.sku.name}
                      </p>
                      <p className="text-sm text-gray-500">
                        {alert.message} - å½“å‰åº“å­˜: {alert.currentStock}
                      </p>
                    </div>
                  </div>
                </div>
                <div className="ml-4 flex-shrink-0">
                  <span className={`
                    inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                    ${alert.severity === 'critical' 
                      ? 'bg-red-100 text-red-800'
                      : alert.severity === 'high'
                        ? 'bg-orange-100 text-orange-800'
                        : alert.severity === 'medium'
                          ? 'bg-yellow-100 text-yellow-800'
                          : 'bg-blue-100 text-blue-800'
                    }
                  `}>
                    {alert.severity === 'critical' ? 'ç´§æ€¥' :
                     alert.severity === 'high' ? 'é«˜' :
                     alert.severity === 'medium' ? 'ä¸­' : 'ä½'}
                  </span>
                </div>
              </div>
            </li>
          ))}
        </ul>
        {data.stockAlerts.length > 5 && (
          <div className="bg-gray-50 px-4 py-3 text-center">
            <span className="text-sm text-gray-500">
              è¿˜æœ‰ {data.stockAlerts.length - 5} ä¸ªé¢„è­¦...
            </span>
          </div>
        )}
      </div>
    </div>
  );
};

export default InventoryOverviewPanel;
```

### 2.5 InventoryItemsList åº“å­˜é¡¹ç›®åˆ—è¡¨ç»„ä»¶

```typescript
// src/components/inventory/InventoryItemsList.tsx
import React, { useState, useMemo } from 'react';
import { toast } from 'react-hot-toast';
import {
  PencilIcon,
  AdjustmentsIcon,
  MapPinIcon,
  UploadIcon
} from '@heroicons/react/24/outline';

import { InventoryFilters, StockAdjustmentModal, LocationChangeModal, BulkUpdateModal } from '../ui';
import { formatCurrency, formatDate } from '../../utils/format';

interface InventoryItemsListProps {
  items: InventoryItem[];
  onStockAdjustment: (adjustment: StockAdjustmentData) => void;
  onLocationChange: (itemId: string, newLocation: string) => void;
  onBulkUpdate: (updates: BulkInventoryUpdate[]) => void;
}

const InventoryItemsList: React.FC<InventoryItemsListProps> = ({
  items,
  onStockAdjustment,
  onLocationChange,
  onBulkUpdate
}) => {
  const [filteredItems, setFilteredItems] = useState<InventoryItem[]>([]);
  const [selectedItems, setSelectedItems] = useState<string[]>([]);
  const [filters, setFilters] = useState<InventoryFilters>({
    warehouse: '',
    category: '',
    status: [],
    alertLevel: [],
    searchTerm: ''
  });
  const [showAdjustmentModal, setShowAdjustmentModal] = useState<string | null>(null);
  const [showLocationModal, setShowLocationModal] = useState<string | null>(null);
  const [showBulkUpdateModal, setShowBulkUpdateModal] = useState(false);

  // åº”ç”¨ç­›é€‰å™¨
  React.useEffect(() => {
    let filtered = [...items];

    if (filters.warehouse) {
      filtered = filtered.filter(item => item.warehouseId === filters.warehouse);
    }

    if (filters.category) {
      filtered = filtered.filter(item => item.sku.categoryId === filters.category);
    }

    if (filters.status.length > 0) {
      filtered = filtered.filter(item => filters.status.includes(item.status));
    }

    if (filters.alertLevel.length > 0) {
      filtered = filtered.filter(item => {
        const alertLevel = getAlertLevel(item);
        return filters.alertLevel.includes(alertLevel);
      });
    }

    if (filters.searchTerm) {
      const searchLower = filters.searchTerm.toLowerCase();
      filtered = filtered.filter(item =>
        item.sku.name.toLowerCase().includes(searchLower) ||
        item.sku.code.toLowerCase().includes(searchLower) ||
        item.location.toLowerCase().includes(searchLower)
      );
    }

    setFilteredItems(filtered);
  }, [items, filters]);

  const getAlertLevel = (item: InventoryItem): AlertSeverity => {
    if (item.currentStock === 0) return 'critical';
    if (item.currentStock <= item.minStockLevel * 0.5) return 'high';
    if (item.currentStock <= item.minStockLevel) return 'medium';
    if (item.currentStock >= item.maxStockLevel) return 'medium';
    return 'low';
  };

  const getStockStatus = (item: InventoryItem) => {
    if (item.currentStock === 0) {
      return { text: 'ç¼ºè´§', color: 'red' };
    } else if (item.currentStock <= item.minStockLevel) {
      return { text: 'åº“å­˜ä¸è¶³', color: 'yellow' };
    } else if (item.currentStock >= item.maxStockLevel) {
      return { text: 'åº“å­˜è¿‡é‡', color: 'orange' };
    } else {
      return { text: 'æ­£å¸¸', color: 'green' };
    }
  };

  const handleBulkSelection = (itemId: string, checked: boolean) => {
    if (checked) {
      setSelectedItems(prev => [...prev, itemId]);
    } else {
      setSelectedItems(prev => prev.filter(id => id !== itemId));
    }
  };

  const handleSelectAll = (checked: boolean) => {
    if (checked) {
      setSelectedItems(filteredItems.map(item => item.id));
    } else {
      setSelectedItems([]);
    }
  };

  // ç»Ÿè®¡æ•°æ®
  const stats = useMemo(() => {
    const total = filteredItems.length;
    const totalValue = filteredItems.reduce((sum, item) => sum + item.totalValue, 0);
    const lowStock = filteredItems.filter(item => 
      item.currentStock <= item.minStockLevel && item.currentStock > 0
    ).length;
    const outOfStock = filteredItems.filter(item => item.currentStock === 0).length;

    return { total, totalValue, lowStock, outOfStock };
  }, [filteredItems]);

  return (
    <div className="space-y-6">
      {/* ç»Ÿè®¡å¡ç‰‡ */}
      <div className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
        <div className="bg-white overflow-hidden shadow rounded-lg">
          <div className="p-5">
            <div className="flex items-center">
              <div className="flex-shrink-0">
                <PackageIcon className="h-8 w-8 text-gray-400" />
              </div>
              <div className="ml-5 w-0 flex-1">
                <dl>
                  <dt className="text-sm font-medium text-gray-500 truncate">æ€»å•†å“æ•°</dt>
                  <dd className="text-lg font-medium text-gray-900">{stats.total}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div className="bg-white overflow-hidden shadow rounded-lg">
          <div className="p-5">
            <div className="flex items-center">
              <div className="flex-shrink-0">
                <CurrencyDollarIcon className="h-8 w-8 text-gray-400" />
              </div>
              <div className="ml-5 w-0 flex-1">
                <dl>
                  <dt className="text-sm font-medium text-gray-500 truncate">æ€»ä»·å€¼</dt>
                  <dd className="text-lg font-medium text-gray-900">{formatCurrency(stats.totalValue)}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div className="bg-white overflow-hidden shadow rounded-lg">
          <div className="p-5">
            <div className="flex items-center">
              <div className="flex-shrink-0">
                <ExclamationTriangleIcon className="h-8 w-8 text-yellow-400" />
              </div>
              <div className="ml-5 w-0 flex-1">
                <dl>
                  <dt className="text-sm font-medium text-gray-500 truncate">ä½åº“å­˜</dt>
                  <dd className="text-lg font-medium text-gray-900">{stats.lowStock}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div className="bg-white overflow-hidden shadow rounded-lg">
          <div className="p-5">
            <div className="flex items-center">
              <div className="flex-shrink-0">
                <XCircleIcon className="h-8 w-8 text-red-400" />
              </div>
              <div className="ml-5 w-0 flex-1">
                <dl>
                  <dt className="text-sm font-medium text-gray-500 truncate">ç¼ºè´§</dt>
                  <dd className="text-lg font-medium text-gray-900">{stats.outOfStock}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* ç­›é€‰å™¨å’Œæ“ä½œæŒ‰é’® */}
      <div className="bg-white p-4 rounded-lg shadow">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-medium text-gray-900">åº“å­˜é¡¹ç›®</h3>
          <div className="flex items-center space-x-3">
            {selectedItems.length > 0 && (
              <button
                onClick={() => setShowBulkUpdateModal(true)}
                className="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
              >
                <PencilIcon className="h-4 w-4 mr-2" />
                æ‰¹é‡ç¼–è¾‘ ({selectedItems.length})
              </button>
            )}
            <button
              onClick={() => {/* å¯¼å‡ºé€‰ä¸­é¡¹ç›® */}}
              className="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
            >
              <UploadIcon className="h-4 w-4 mr-2" />
              å¯¼å‡º
            </button>
          </div>
        </div>

        <InventoryFilters 
          filters={filters}
          onFiltersChange={setFilters}
          warehouses={[...new Set(items.map(item => item.warehouse))]}
          categories={[...new Set(items.map(item => item.sku.category))]}
        />
      </div>

      {/* åº“å­˜é¡¹ç›®è¡¨æ ¼ */}
      <div className="bg-white shadow overflow-hidden sm:rounded-md">
        <table className="min-w-full divide-y divide-gray-200">
          <thead className="bg-gray-50">
            <tr>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                <input
                  type="checkbox"
                  checked={selectedItems.length === filteredItems.length && filteredItems.length > 0}
                  onChange={(e) => handleSelectAll(e.target.checked)}
                  className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                />
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                å•†å“ä¿¡æ¯
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                åº“ä½
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                å½“å‰åº“å­˜
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                åº“å­˜èŒƒå›´
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                çŠ¶æ€
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                æœ€åå˜åŠ¨
              </th>
              <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                æ“ä½œ
              </th>
            </tr>
          </thead>
          <tbody className="bg-white divide-y divide-gray-200">
            {filteredItems.map((item) => {
              const stockStatus = getStockStatus(item);
              return (
                <tr key={item.id} className="hover:bg-gray-50">
                  <td className="px-6 py-4 whitespace-nowrap">
                    <input
                      type="checkbox"
                      checked={selectedItems.includes(item.id)}
                      onChange={(e) => handleBulkSelection(item.id, e.target.checked)}
                      className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                    />
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="flex items-center">
                      <div className="h-10 w-10 flex-shrink-0">
                        <img
                          className="h-10 w-10 rounded-full object-cover"
                          src={item.sku.imageUrl || '/placeholder-product.jpg'}
                          alt={item.sku.name}
                        />
                      </div>
                      <div className="ml-4">
                        <div className="text-sm font-medium text-gray-900">{item.sku.name}</div>
                        <div className="text-sm text-gray-500">{item.sku.code}</div>
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="text-sm text-gray-900">{item.warehouse.name}</div>
                    <div className="text-sm text-gray-500">{item.location}</div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {item.currentStock} {item.sku.unit}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {item.minStockLevel} - {item.maxStockLevel}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <span className={`
                      inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                      ${stockStatus.color === 'green' ? 'bg-green-100 text-green-800' :
                        stockStatus.color === 'yellow' ? 'bg-yellow-100 text-yellow-800' :
                        stockStatus.color === 'orange' ? 'bg-orange-100 text-orange-800' :
                        'bg-red-100 text-red-800'}
                    `}>
                      {stockStatus.text}
                    </span>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {formatDate(item.lastMovementDate)}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <div className="flex items-center justify-end space-x-2">
                      <button
                        onClick={() => setShowAdjustmentModal(item.id)}
                        className="text-blue-600 hover:text-blue-900"
                        title="åº“å­˜è°ƒæ•´"
                      >
                        <AdjustmentsIcon className="h-4 w-4" />
                      </button>
                      <button
                        onClick={() => setShowLocationModal(item.id)}
                        className="text-green-600 hover:text-green-900"
                        title="åº“ä½å˜æ›´"
                      >
                        <MapPinIcon className="h-4 w-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>

        {filteredItems.length === 0 && (
          <div className="text-center py-12">
            <PackageIcon className="mx-auto h-12 w-12 text-gray-400" />
            <h3 className="mt-2 text-sm font-medium text-gray-900">æ²¡æœ‰æ‰¾åˆ°åº“å­˜é¡¹ç›®</h3>
            <p className="mt-1 text-sm text-gray-500">è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æ·»åŠ æ–°çš„åº“å­˜é¡¹ç›®ã€‚</p>
          </div>
        )}
      </div>

      {/* æ¨¡æ€æ¡† */}
      {showAdjustmentModal && (
        <StockAdjustmentModal
          item={items.find(item => item.id === showAdjustmentModal)!}
          onSave={(adjustment) => {
            onStockAdjustment(adjustment);
            setShowAdjustmentModal(null);
          }}
          onClose={() => setShowAdjustmentModal(null)}
        />
      )}

      {showLocationModal && (
        <LocationChangeModal
          item={items.find(item => item.id === showLocationModal)!}
          onSave={(newLocation) => {
            onLocationChange(showLocationModal, newLocation);
            setShowLocationModal(null);
          }}
          onClose={() => setShowLocationModal(null)}
        />
      )}

      {showBulkUpdateModal && (
        <BulkUpdateModal
          selectedItems={selectedItems}
          items={items}
          onSave={(updates) => {
            onBulkUpdate(updates);
            setShowBulkUpdateModal(false);
            setSelectedItems([]);
          }}
          onClose={() => setShowBulkUpdateModal(false)}
        />
      )}
    </div>
  );
};

export default InventoryItemsList;
```

---

**ç¬¬äº”æ‰¹åº“å­˜ç®¡ç†æ¨¡å—è¯¦ç»†æ–‡æ¡£å·²å®Œæˆï¼**

æˆ‘å·²ç»åˆ›å»ºäº†å®Œæ•´çš„åº“å­˜ç®¡ç†ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£ï¼ŒåŒ…å«ï¼š

1. **å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰**
2. **Inventory ä¸»ç»„ä»¶**
3. **InventoryOverviewPanel åº“å­˜æ¦‚è§ˆç»„ä»¶**  
4. **InventoryItemsList åº“å­˜é¡¹ç›®åˆ—è¡¨ç»„ä»¶**

è¯¥æ–‡æ¡£æä¾›äº†åº“å­˜ç®¡ç†çš„å®Œæ•´å®ç°æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š

- ğŸ“Š åº“å­˜æ¦‚è§ˆä¸ç»Ÿè®¡
- ğŸ“¦ åº“å­˜é¡¹ç›®ç®¡ç†
- ğŸ“ åº“ä½ç®¡ç†ä¸è°ƒé…
- ğŸ”„ åº“å­˜å˜åŠ¨è¿½è¸ª
- âš ï¸ åº“å­˜é¢„è­¦æœºåˆ¶
- ğŸ“¤ æ‰¹é‡æ“ä½œä¸å¯¼å…¥å¯¼å‡º

æ¥ä¸‹æ¥æˆ‘å¯ä»¥ç»§ç»­åˆ›å»ºï¼š
- ä¾›åº”å•†ç®¡ç†ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£
- æŠ¥è¡¨ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£

éœ€è¦æˆ‘ç»§ç»­åˆ›å»ºä¸‹ä¸€ä¸ªæ¨¡å—çš„è¯¦ç»†æ–‡æ¡£å—ï¼Ÿ
