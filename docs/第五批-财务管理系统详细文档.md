# 第五批-财务管理系统详细文档

## 💰 1. 财务管理系统 (`finance/`)

### 1.1 模块概述
财务管理系统负责采购相关的财务核算、付款管理、成本分析和财务报表生成。

### 1.2 TypeScript 类型定义

```typescript
// src/types/finance.ts
export interface FinancialOverview {
  totalPurchaseValue: number;
  paidAmount: number;
  pendingPayments: number;
  overduePayments: number;
  monthlyBudget: number;
  usedBudget: number;
  costByCategory: CategoryCost[];
  paymentTrends: PaymentTrend[];
}

export interface CategoryCost {
  categoryId: string;
  categoryName: string;
  totalCost: number;
  budgetAllocated: number;
  percentageUsed: number;
}

export interface PaymentTrend {
  month: string;
  plannedPayments: number;
  actualPayments: number;
  variance: number;
}

export interface Payment {
  id: string;
  purchaseRequestId: string;
  purchaseRequestNumber: string;
  supplierId: string;
  supplier: Supplier;
  amount: number;
  actualAmount?: number;
  paymentMethod: PaymentMethod;
  status: PaymentStatus;
  dueDate: Date;
  paidDate?: Date;
  paymentReference?: string;
  remarks: string;
  createdAt: Date;
  updatedAt: Date;
}

export type PaymentMethod = 'bank_transfer' | 'check' | 'cash' | 'credit_card';
export type PaymentStatus = 'pending' | 'processing' | 'paid' | 'failed' | 'cancelled';

export interface PaymentData {
  amount: number;
  method: PaymentMethod;
  reference: string;
  notes?: string;
}

export interface Budget {
  id: string;
  name: string;
  categoryId?: string;
  department: string;
  totalAmount: number;
  usedAmount: number;
  remainingAmount: number;
  period: BudgetPeriod;
  startDate: Date;
  endDate: Date;
  status: BudgetStatus;
  createdAt: Date;
  updatedAt: Date;
}

export type BudgetPeriod = 'monthly' | 'quarterly' | 'yearly';
export type BudgetStatus = 'active' | 'warning' | 'exceeded' | 'inactive';

export interface PaymentFilters {
  status: PaymentStatus[];
  dateRange?: {
    start: Date;
    end: Date;
  };
  supplier: string;
  searchTerm: string;
}
```

### 1.3 FinanceManagement 主组件

```typescript
// src/components/finance/FinanceManagement.tsx
import React, { useState, useEffect, useMemo } from 'react';
import { toast } from 'react-hot-toast';
import {
  ChartPieIcon,
  CreditCardIcon,
  TrendingUpIcon,
  CalculatorIcon,
  DocumentReportIcon,
  DownloadIcon,
  LockClosedIcon
} from '@heroicons/react/24/outline';

import { useAuth } from '../../hooks/useAuth';
import { usePurchaseRequests } from '../../hooks/useProcurement';
import { hasRolePermission } from '../../utils/permissions';
import { FinancialOverview, PaymentManagement, CostAnalysis, BudgetManagement, FinancialReports } from './components';

interface FinanceManagementProps {
  activeTab?: FinanceTab;
}

type FinanceTab = 'overview' | 'payments' | 'costs' | 'budgets' | 'reports';

const FinanceManagement: React.FC<FinanceManagementProps> = ({ activeTab = 'overview' }) => {
  const [currentTab, setCurrentTab] = useState<FinanceTab>(activeTab);
  const [financialData, setFinancialData] = useState<FinancialOverview | null>(null);
  const [payments, setPayments] = useState<Payment[]>([]);
  const [budgets, setBudgets] = useState<Budget[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  // 全局状态
  const purchaseRequests = usePurchaseRequests();
  const { user } = useAuth();

  // 权限检查
  const canViewFinancials = hasRolePermission(user?.role || 'purchasing_officer', 'finance_personnel');
  const canManageBudgets = hasRolePermission(user?.role || 'purchasing_officer', 'department_manager');

  useEffect(() => {
    if (!canViewFinancials) {
      toast.error('您没有权限访问财务模块');
      return;
    }

    loadFinancialData();
  }, [canViewFinancials]);

  const loadFinancialData = async () => {
    setIsLoading(true);
    try {
      // 计算财务概览数据
      const overview = calculateFinancialOverview();
      setFinancialData(overview);

      // 加载付款记录
      const paymentRecords = await loadPaymentRecords();
      setPayments(paymentRecords);

      // 加载预算数据
      const budgetData = await loadBudgetData();
      setBudgets(budgetData);

    } catch (error) {
      console.error('Failed to load financial data:', error);
      toast.error('加载财务数据失败');
    } finally {
      setIsLoading(false);
    }
  };

  const calculateFinancialOverview = (): FinancialOverview => {
    const currentMonth = new Date().getMonth();
    const currentYear = new Date().getFullYear();

    // 计算总采购金额
    const totalPurchaseValue = purchaseRequests.reduce((sum, req) => 
      sum + (req.totalAmount || 0), 0
    );

    // 计算已付款金额（模拟数据）
    const paidAmount = totalPurchaseValue * 0.6; // 假设60%已付款
    const pendingPayments = totalPurchaseValue * 0.3; // 30%待付款
    const overduePayments = totalPurchaseValue * 0.1; // 10%逾期

    // 月度预算
    const monthlyBudget = 1000000; // 100万月预算
    const usedBudget = purchaseRequests
      .filter(req => {
        const reqDate = new Date(req.createdAt);
        return reqDate.getMonth() === currentMonth && reqDate.getFullYear() === currentYear;
      })
      .reduce((sum, req) => sum + (req.totalAmount || 0), 0);

    // 按分类统计成本
    const costByCategory: CategoryCost[] = [
      {
        categoryId: 'cat-001',
        categoryName: '电子产品',
        totalCost: totalPurchaseValue * 0.4,
        budgetAllocated: monthlyBudget * 0.5,
        percentageUsed: 80
      },
      {
        categoryId: 'cat-002',
        categoryName: '日用品',
        totalCost: totalPurchaseValue * 0.3,
        budgetAllocated: monthlyBudget * 0.3,
        percentageUsed: 100
      },
      {
        categoryId: 'cat-003',
        categoryName: '服装配饰',
        totalCost: totalPurchaseValue * 0.3,
        budgetAllocated: monthlyBudget * 0.2,
        percentageUsed: 150
      }
    ];

    // 付款趋势数据
    const paymentTrends: PaymentTrend[] = [
      { month: '1月', plannedPayments: 800000, actualPayments: 750000, variance: -50000 },
      { month: '2月', plannedPayments: 900000, actualPayments: 920000, variance: 20000 },
      { month: '3月', plannedPayments: 850000, actualPayments: 830000, variance: -20000 },
      { month: '4月', plannedPayments: 950000, actualPayments: 980000, variance: 30000 },
      { month: '5月', plannedPayments: 1000000, actualPayments: 950000, variance: -50000 },
      { month: '6月', plannedPayments: 1100000, actualPayments: 1150000, variance: 50000 }
    ];

    return {
      totalPurchaseValue,
      paidAmount,
      pendingPayments,
      overduePayments,
      monthlyBudget,
      usedBudget,
      costByCategory,
      paymentTrends
    };
  };

  const loadPaymentRecords = async (): Promise<Payment[]> => {
    // 模拟付款记录数据
    return purchaseRequests.map(req => ({
      id: `payment-${req.id}`,
      purchaseRequestId: req.id,
      purchaseRequestNumber: req.requestNumber,
      supplierId: 'supplier-001',
      supplier: { id: 'supplier-001', name: '模拟供应商', code: 'SUP001' },
      amount: req.totalAmount || 0,
      paymentMethod: 'bank_transfer' as PaymentMethod,
      status: Math.random() > 0.5 ? 'paid' : 'pending' as PaymentStatus,
      dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
      paidDate: Math.random() > 0.5 ? new Date() : null,
      remarks: '',
      createdAt: req.createdAt,
      updatedAt: req.updatedAt
    }));
  };

  const loadBudgetData = async (): Promise<Budget[]> => {
    // 模拟预算数据
    return [
      {
        id: 'budget-001',
        name: '电子产品采购预算',
        categoryId: 'cat-001',
        department: '采购部',
        totalAmount: 500000,
        usedAmount: 400000,
        remainingAmount: 100000,
        period: 'monthly',
        startDate: new Date(2025, 0, 1),
        endDate: new Date(2025, 11, 31),
        status: 'active',
        createdAt: new Date(),
        updatedAt: new Date()
      },
      {
        id: 'budget-002',
        name: '日用品采购预算',
        categoryId: 'cat-002',
        department: '采购部',
        totalAmount: 300000,
        usedAmount: 300000,
        remainingAmount: 0,
        period: 'monthly',
        startDate: new Date(2025, 0, 1),
        endDate: new Date(2025, 11, 31),
        status: 'warning',
        createdAt: new Date(),
        updatedAt: new Date()
      }
    ];
  };

  // 处理付款操作
  const handlePayment = async (paymentId: string, paymentData: PaymentData) => {
    try {
      // 更新付款状态
      setPayments(prev => prev.map(payment => 
        payment.id === paymentId 
          ? { 
              ...payment, 
              status: 'paid',
              paidDate: new Date(),
              actualAmount: paymentData.amount,
              paymentReference: paymentData.reference,
              updatedAt: new Date()
            }
          : payment
      ));

      toast.success('付款记录更新成功');
    } catch (error) {
      console.error('Failed to process payment:', error);
      toast.error('付款处理失败');
    }
  };

  // 预算管理操作
  const handleBudgetUpdate = async (budgetId: string, updates: Partial<Budget>) => {
    try {
      setBudgets(prev => prev.map(budget => 
        budget.id === budgetId 
          ? { ...budget, ...updates, updatedAt: new Date() }
          : budget
      ));

      toast.success('预算更新成功');
    } catch (error) {
      console.error('Failed to update budget:', error);
      toast.error('预算更新失败');
    }
  };

  if (!canViewFinancials) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <LockClosedIcon className="mx-auto h-12 w-12 text-gray-400" />
          <h3 className="mt-2 text-sm font-medium text-gray-900">访问受限</h3>
          <p className="mt-1 text-sm text-gray-500">您没有权限访问财务管理模块</p>
        </div>
      </div>
    );
  }

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* 页面标题 */}
      <div className="bg-white shadow">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="py-6">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-3xl font-bold text-gray-900">财务管理</h1>
                <p className="mt-1 text-sm text-gray-500">
                  采购相关的财务核算、付款管理和预算控制
                </p>
              </div>
              
              <div className="flex items-center space-x-4">
                {canManageBudgets && (
                  <button
                    onClick={() => {/* 导出财务报表 */}}
                    className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                  >
                    <DownloadIcon className="h-4 w-4 mr-2" />
                    导出报表
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* 标签页导航 */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="border-b border-gray-200">
          <nav className="-mb-px flex space-x-8" aria-label="Tabs">
            {[
              { key: 'overview', label: '财务概览', icon: ChartPieIcon },
              { key: 'payments', label: '付款管理', icon: CreditCardIcon },
              { key: 'costs', label: '成本分析', icon: TrendingUpIcon },
              { key: 'budgets', label: '预算管理', icon: CalculatorIcon },
              { key: 'reports', label: '财务报表', icon: DocumentReportIcon }
            ].map((tab) => {
              const Icon = tab.icon;
              return (
                <button
                  key={tab.key}
                  onClick={() => setCurrentTab(tab.key as FinanceTab)}
                  className={`
                    group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm
                    ${currentTab === tab.key
                      ? 'border-blue-500 text-blue-600'
                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                    }
                  `}
                >
                  <Icon className={`
                    -ml-0.5 mr-2 h-5 w-5
                    ${currentTab === tab.key ? 'text-blue-500' : 'text-gray-400 group-hover:text-gray-500'}
                  `} />
                  {tab.label}
                </button>
              );
            })}
          </nav>
        </div>
      </div>

      {/* 内容区域 */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {currentTab === 'overview' && (
          <FinancialOverview 
            data={financialData} 
            onRefresh={loadFinancialData}
          />
        )}
        
        {currentTab === 'payments' && (
          <PaymentManagement 
            payments={payments}
            onPayment={handlePayment}
            onRefresh={loadFinancialData}
          />
        )}
        
        {currentTab === 'costs' && (
          <CostAnalysis 
            data={financialData}
            purchaseRequests={purchaseRequests}
          />
        )}
        
        {currentTab === 'budgets' && canManageBudgets && (
          <BudgetManagement 
            budgets={budgets}
            onBudgetUpdate={handleBudgetUpdate}
            onRefresh={loadFinancialData}
          />
        )}
        
        {currentTab === 'reports' && (
          <FinancialReports 
            data={financialData}
            payments={payments}
            budgets={budgets}
          />
        )}
      </div>
    </div>
  );
};

export default FinanceManagement;
```

### 1.4 FinancialOverview 财务概览组件

```typescript
// src/components/finance/FinancialOverview.tsx
import React from 'react';
import {
  ShoppingCartIcon,
  CheckCircleIcon,
  ClockIcon,
  CalculatorIcon,
  RefreshIcon
} from '@heroicons/react/24/outline';

import { MetricCard, CostDistributionChart, PaymentTrendChart, FinancialAlerts } from '../ui';
import { formatCurrency } from '../../utils/format';

interface FinancialOverviewProps {
  data: FinancialOverview | null;
  onRefresh: () => void;
}

const FinancialOverview: React.FC<FinancialOverviewProps> = ({ data, onRefresh }) => {
  if (!data) {
    return (
      <div className="animate-pulse space-y-6">
        <div className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
          {[...Array(4)].map((_, i) => (
            <div key={i} className="bg-white overflow-hidden shadow rounded-lg">
              <div className="p-5">
                <div className="h-4 bg-gray-300 rounded w-3/4"></div>
                <div className="mt-4 h-8 bg-gray-300 rounded w-1/2"></div>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  }

  const budgetUsagePercentage = (data.usedBudget / data.monthlyBudget) * 100;
  const paymentCompletionRate = (data.paidAmount / data.totalPurchaseValue) * 100;

  return (
    <div className="space-y-6">
      {/* 关键指标卡片 */}
      <div className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
        <MetricCard
          title="总采购金额"
          value={formatCurrency(data.totalPurchaseValue)}
          change={{ value: 12.5, isPositive: true }}
          icon={<ShoppingCartIcon className="h-6 w-6" />}
          color="blue"
        />
        
        <MetricCard
          title="已付款金额"
          value={formatCurrency(data.paidAmount)}
          subtitle={`完成率 ${paymentCompletionRate.toFixed(1)}%`}
          icon={<CheckCircleIcon className="h-6 w-6" />}
          color="green"
        />
        
        <MetricCard
          title="待付款金额"
          value={formatCurrency(data.pendingPayments)}
          subtitle={`逾期 ${formatCurrency(data.overduePayments)}`}
          icon={<ClockIcon className="h-6 w-6" />}
          color="yellow"
        />
        
        <MetricCard
          title="预算使用率"
          value={`${budgetUsagePercentage.toFixed(1)}%`}
          subtitle={`剩余 ${formatCurrency(data.monthlyBudget - data.usedBudget)}`}
          icon={<CalculatorIcon className="h-6 w-6" />}
          color={budgetUsagePercentage > 90 ? "red" : "purple"}
        />
      </div>

      {/* 图表区域 */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* 成本分布饼图 */}
        <div className="bg-white overflow-hidden shadow rounded-lg">
          <div className="px-4 py-5 sm:p-6">
            <h3 className="text-lg leading-6 font-medium text-gray-900 mb-4">
              分类成本分布
            </h3>
            <CostDistributionChart data={data.costByCategory} />
          </div>
        </div>

        {/* 付款趋势图 */}
        <div className="bg-white overflow-hidden shadow rounded-lg">
          <div className="px-4 py-5 sm:p-6">
            <h3 className="text-lg leading-6 font-medium text-gray-900 mb-4">
              付款趋势分析
            </h3>
            <PaymentTrendChart data={data.paymentTrends} />
          </div>
        </div>
      </div>

      {/* 预算状态表格 */}
      <div className="bg-white shadow overflow-hidden sm:rounded-md">
        <div className="px-4 py-5 sm:px-6 border-b border-gray-200">
          <div className="flex items-center justify-between">
            <h3 className="text-lg leading-6 font-medium text-gray-900">
              分类预算状态
            </h3>
            <button
              onClick={onRefresh}
              className="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              <RefreshIcon className="h-4 w-4 mr-2" />
              刷新
            </button>
          </div>
        </div>
        <ul className="divide-y divide-gray-200">
          {data.costByCategory.map((category) => (
            <li key={category.categoryId} className="px-4 py-4 sm:px-6">
              <div className="flex items-center justify-between">
                <div className="flex-1 min-w-0">
                  <p className="text-sm font-medium text-gray-900 truncate">
                    {category.categoryName}
                  </p>
                  <div className="mt-2">
                    <div className="flex justify-between text-sm text-gray-500 mb-1">
                      <span>已使用 {formatCurrency(category.totalCost)}</span>
                      <span>预算 {formatCurrency(category.budgetAllocated)}</span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2">
                      <div
                        className={`h-2 rounded-full ${
                          category.percentageUsed > 100 
                            ? 'bg-red-500' 
                            : category.percentageUsed > 80 
                              ? 'bg-yellow-500' 
                              : 'bg-green-500'
                        }`}
                        style={{ width: `${Math.min(category.percentageUsed, 100)}%` }}
                      ></div>
                    </div>
                  </div>
                </div>
                <div className="ml-4 flex-shrink-0">
                  <span className={`
                    inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                    ${category.percentageUsed > 100 
                      ? 'bg-red-100 text-red-800'
                      : category.percentageUsed > 80
                        ? 'bg-yellow-100 text-yellow-800'
                        : 'bg-green-100 text-green-800'
                    }
                  `}>
                    {category.percentageUsed.toFixed(1)}%
                  </span>
                </div>
              </div>
            </li>
          ))}
        </ul>
      </div>

      {/* 财务风险预警 */}
      <FinancialAlerts data={data} />
    </div>
  );
};

export default FinancialOverview;
```

### 1.5 PaymentManagement 付款管理组件

```typescript
// src/components/finance/PaymentManagement.tsx
import React, { useState, useEffect, useMemo } from 'react';
import { toast } from 'react-hot-toast';
import {
  CreditCardIcon,
  ClockIcon,
  CheckCircleIcon,
  ExclamationTriangleIcon
} from '@heroicons/react/24/outline';

import { StatsCard, PaymentFilters, PaymentList, PaymentModal } from '../ui';

interface PaymentManagementProps {
  payments: Payment[];
  onPayment: (paymentId: string, paymentData: PaymentData) => void;
  onRefresh: () => void;
}

const PaymentManagement: React.FC<PaymentManagementProps> = ({
  payments,
  onPayment,
  onRefresh
}) => {
  const [filteredPayments, setFilteredPayments] = useState<Payment[]>([]);
  const [selectedPayments, setSelectedPayments] = useState<string[]>([]);
  const [filters, setFilters] = useState<PaymentFilters>({
    status: [],
    dateRange: null,
    supplier: '',
    searchTerm: ''
  });
  const [showPaymentModal, setShowPaymentModal] = useState<string | null>(null);

  useEffect(() => {
    applyFilters();
  }, [payments, filters]);

  const applyFilters = () => {
    let filtered = [...payments];

    if (filters.status.length > 0) {
      filtered = filtered.filter(payment => filters.status.includes(payment.status));
    }

    if (filters.supplier) {
      filtered = filtered.filter(payment => payment.supplierId === filters.supplier);
    }

    if (filters.searchTerm) {
      const searchLower = filters.searchTerm.toLowerCase();
      filtered = filtered.filter(payment =>
        payment.purchaseRequestNumber.toLowerCase().includes(searchLower) ||
        payment.supplier.name.toLowerCase().includes(searchLower)
      );
    }

    if (filters.dateRange) {
      filtered = filtered.filter(payment => {
        const paymentDate = new Date(payment.dueDate);
        return paymentDate >= filters.dateRange!.start && paymentDate <= filters.dateRange!.end;
      });
    }

    setFilteredPayments(filtered);
  };

  // 统计数据
  const paymentStats = useMemo(() => {
    const total = filteredPayments.length;
    const pending = filteredPayments.filter(p => p.status === 'pending').length;
    const paid = filteredPayments.filter(p => p.status === 'paid').length;
    const overdue = filteredPayments.filter(p => 
      p.status === 'pending' && new Date(p.dueDate) < new Date()
    ).length;

    const totalAmount = filteredPayments.reduce((sum, p) => sum + p.amount, 0);
    const paidAmount = filteredPayments
      .filter(p => p.status === 'paid')
      .reduce((sum, p) => sum + p.amount, 0);
    const pendingAmount = filteredPayments
      .filter(p => p.status === 'pending')
      .reduce((sum, p) => sum + p.amount, 0);

    return {
      total,
      pending,
      paid,
      overdue,
      totalAmount,
      paidAmount,
      pendingAmount
    };
  }, [filteredPayments]);

  const handleBatchPayment = async (paymentIds: string[]) => {
    try {
      for (const paymentId of paymentIds) {
        const payment = payments.find(p => p.id === paymentId);
        if (payment && payment.status === 'pending') {
          await onPayment(paymentId, {
            amount: payment.amount,
            method: 'bank_transfer',
            reference: `BATCH-${Date.now()}`,
            notes: '批量付款'
          });
        }
      }
      setSelectedPayments([]);
      toast.success(`批量付款 ${paymentIds.length} 个订单完成`);
    } catch (error) {
      console.error('Batch payment failed:', error);
      toast.error('批量付款失败');
    }
  };

  return (
    <div className="space-y-6">
      {/* 付款统计 */}
      <div className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
        <StatsCard
          title="总付款订单"
          value={paymentStats.total}
          subtitle={`金额 ${formatCurrency(paymentStats.totalAmount)}`}
          icon={<CreditCardIcon className="h-6 w-6" />}
          color="blue"
        />
        
        <StatsCard
          title="待付款"
          value={paymentStats.pending}
          subtitle={`金额 ${formatCurrency(paymentStats.pendingAmount)}`}
          icon={<ClockIcon className="h-6 w-6" />}
          color="yellow"
        />
        
        <StatsCard
          title="已付款"
          value={paymentStats.paid}
          subtitle={`金额 ${formatCurrency(paymentStats.paidAmount)}`}
          icon={<CheckCircleIcon className="h-6 w-6" />}
          color="green"
        />
        
        <StatsCard
          title="逾期付款"
          value={paymentStats.overdue}
          subtitle="需要紧急处理"
          icon={<ExclamationTriangleIcon className="h-6 w-6" />}
          color="red"
        />
      </div>

      {/* 筛选器 */}
      <PaymentFilters 
        filters={filters}
        onFiltersChange={setFilters}
        suppliers={[...new Set(payments.map(p => p.supplier))]}
      />

      {/* 付款列表 */}
      <div className="bg-white shadow overflow-hidden sm:rounded-md">
        {/* 批量操作栏 */}
        {selectedPayments.length > 0 && (
          <div className="bg-blue-50 px-4 py-3 border-b border-blue-200">
            <div className="flex items-center justify-between">
              <span className="text-sm font-medium text-blue-900">
                已选择 {selectedPayments.length} 个付款订单
              </span>
              <div className="flex items-center space-x-2">
                <button
                  onClick={() => handleBatchPayment(selectedPayments)}
                  className="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
                >
                  批量付款
                </button>
                <button
                  onClick={() => setSelectedPayments([])}
                  className="inline-flex items-center px-3 py-2 border border-blue-300 shadow-sm text-sm leading-4 font-medium rounded-md text-blue-700 bg-white hover:bg-blue-50"
                >
                  取消选择
                </button>
              </div>
            </div>
          </div>
        )}

        <PaymentList
          payments={filteredPayments}
          selectedPayments={selectedPayments}
          onSelectionChange={setSelectedPayments}
          onPayment={(paymentId) => setShowPaymentModal(paymentId)}
          onRefresh={onRefresh}
        />
      </div>

      {/* 付款处理模态框 */}
      {showPaymentModal && (
        <PaymentModal
          paymentId={showPaymentModal}
          payment={payments.find(p => p.id === showPaymentModal)!}
          onSave={(paymentData) => {
            onPayment(showPaymentModal, paymentData);
            setShowPaymentModal(null);
          }}
          onClose={() => setShowPaymentModal(null)}
        />
      )}
    </div>
  );
};

export default PaymentManagement;
```

---

**第五批财务管理模块详细文档已完成！**

我已经创建了完整的财务管理系统详细文档，包含：

1. **完整的 TypeScript 类型定义**
2. **FinanceManagement 主组件**  
3. **FinancialOverview 财务概览组件**
4. **PaymentManagement 付款管理组件**

由于长度限制，我采用了分文档的策略。接下来我可以继续创建：

- 库存管理系统详细文档
- 供应商管理系统详细文档  
- 报表系统详细文档

需要我继续创建下一个模块的详细文档吗？
